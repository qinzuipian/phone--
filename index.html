<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!--自适应屏幕-->
    <meta name="format-detection" content="telphone=no, email=no" />
    <!--取消ios自动识别手机号码与邮箱-->
    <title>首页</title>
    <link rel="stylesheet" href="plugin/css/mui.min.css" />
    <link href="plugin/css/mui.indexedlist.css" rel="stylesheet" />
    <link rel="stylesheet" href="common.css" />
    <link rel="stylesheet" href="index.css">
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=VzXPUBTBB9rsb4m0LIkhCqwdvx6A8c6e"></script>
    <style>
        #allmap {
            width: 100%;
            height: 800px;
            overflow: hidden;
            margin: 0;
            font-family: "微软雅黑";
        }

        .revise {
            /* left: 18.75rem; */
            position: absolute;
            color: #fff;
            font-size: 12px;
        }

        .deleicon {
            font-size: 30px;
            color: #fff;
            float: right;
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="flex" style="width: 100%;z-index: 999;position: fixed;bottom: 0;left: 0;background: #f6f6f6;border-top: 1px solid pink;line-height: 0">
            <div style="width: 25%;height: 40px;text-align: center;" @click="setTabId(1)">
                <p class="mui-icon mui-icon-location nav-first-p" :class="{'nav-active': tabId == 1}"></p>
                <p class="mui-tab-label nav-sec-p" :class="{'nav-active': tabId == 1}">定位</p>
            </div>
            <div style="width: 25%;height: 40px;text-align: center;" @click="setTabId(2)">
                <p class="mui-icon mui-icon-list nav-first-p" :class="{'nav-active': tabId == 2}"></p>
                <p class="mui-tab-label nav-sec-p" :class="{'nav-active': tabId == 2}">通讯录</p>
            </div>
            <div style="width: 25%;height: 40px;text-align: center;" @click="setTabId(3)">
                <p class="mui-icon mui-icon-compose nav-first-p" :class="{'nav-active': tabId == 3}"></p>
                <p class="mui-tab-label nav-sec-p" :class="{'nav-active': tabId == 3}">工作台</p>
            </div>
            <div style="width: 25%;height: 40px;text-align: center;" @click="setTabId(4)">
                <p class="mui-icon mui-icon-contact nav-first-p" :class="{'nav-active': tabId == 4}"></p>
                <p class="mui-tab-label nav-sec-p" :class="{'nav-active': tabId == 4}">我的</p>
            </div>
        </div>

        <!--底部导航栏点击出现内容-->
        <div class="mui-content ctt-content ctt-content-bottom">
            <div id="tabbar" class="mui-control-content mui-active" v-show="tabId == 1">
                <header class="mui-bar mui-bar-nav">
                    <h1 class="mui-title">
                        定位
                    </h1>
                    <span class="revise" @click="addall">定位服务</span>
                    <!--<span class="mui-icon mui-icon-trash deleicon" style="padding: 0;margin: 0;font-size: 21px;line-height: 40px" @click="delfence"></span>-->
                    <span class="mui-icon mui-icon-trash deleicon" style="padding: 0;margin: 0;font-size: 21px;line-height: 40px"></span>

                </header>
                <div id="allmap"></div>
                <!-- <a class="pic" href="page/location/all.html" style="width: 100%;">
                <img src="images/small.gif" alt="" style="margin-top: 40%;width: 100px;height: 120p;margin-left: calc(50% - 50px);">
            </a> -->
            </div>

            <!--通讯录-->


            <div id="tabbar-with-contact" class="mui-control-content" v-show="tabId == 2">
                <header class="head mui-bar mui-bar-nav">
                    <h1 class="mui-title">
                        通讯录
                    </h1>
                    <a href="page/mailList/add.html" class="person">
                        <span class="mui-icon mui-icon-personadd other"></span>
                    </a>
                </header>

                <div class="mui-content">
                    <div id='listindex' class="mui-indexed-list" style="background: #F6F6F6;border: none;height: auto;">
                        <div class="mui-indexed-list-search mui-input-row mui-search">
                            <input type="search" v-model="searchMail" class="mui-indexed-list-search-input" placeholder="搜索联系人" v-on:blur="changeCount"
                                style="font-size: 12px;">
                        </div>
                        <div class="noMsg" v-if="mailList.length == 0">没有数据</div>
                        <div v-show="!isSearch">
                            <ul class="mail-list-ul" style="background: #FFFFFF; overflow-y: scroll;" v-if="mailList.length > 0">
                                <li class="mail-list-title" v-show="mailListA.length !== 0">A</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListA" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListB.length !== 0">B</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListB" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListC.length !== 0">C</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListC" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListD.length !== 0">D</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListD" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListE.length !== 0">E</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListE" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListF.length !== 0">F</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListF" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListG.length !== 0">G</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListG" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListH.length !== 0">H</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListH" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListI.length !== 0">I</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListI" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListJ.length !== 0">J</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListJ" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListK.length !== 0">K</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListK" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListL.length !== 0">L</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListL" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListM.length !== 0">M</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListM" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListN.length !== 0">N</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListN" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListO.length !== 0">O</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListO" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListP.length !== 0">P</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListP" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListQ.length !== 0">Q</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListQ" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListR.length !== 0">R</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListR" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListS.length !== 0">S</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListS" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListT.length !== 0">T</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListT" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListU.length !== 0">U</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListU" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListV.length !== 0">V</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListV" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListW.length !== 0">W</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListW" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListX.length !== 0">X</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListX" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListY.length !== 0">Y</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListY" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListZ.length !== 0">Z</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListZ" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                                <li class="mail-list-title" v-show="mailListUU.length !== 0">#</li>
                                <div class="mail-list-item-div">
                                    <li class="mail-list-cont" v-for="it in mailListUU" @click="gotoListMsg(it)">
                                        <p v-html="it.contactName" class="mail-list-item"></p>
                                    </li>
                                </div>
                            </ul>
                        </div>
                        <div style="padding-bottom: 28px;" v-show="isSearch">
                            <p style="text-align: center;">可能的匹配项</p>
                            <div class="mail-list-item-div">
                                <li class="mail-list-cont" style="list-style: none;margin-left: 0;width: 100%;" v-for="it in mailListSearch" @click="gotoListMsg(it)">
                                    <p v-html="it.contactName" class="mail-list-item"></p>
                                </li>
                            </div>
                        </div>
                    </div>
                </div>
            </div>







            <div id="tabbar-with-chat" class="mui-control-content" v-show="tabId == 3">
                <header class="mui-bar mui-bar-nav">
                    <!--<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>-->
                    <h1 class="mui-title">
                        工作台
                    </h1>
                </header>
                <ul id="list" class="mui-table-view mui-table-view-chevron">
                    <li class="mui-table-view-cell">
                        <a class="mui-navigate-right" href="./page/job/course.html">
                            <span class="mui-icon mui-icon-bars cur" style="font-size: 12px;"></span>
                            <span class="num">课程表</span>
                        </a>
                    </li>
                </ul>
                <ul id="list" class="mui-table-view mui-table-view-chevron">
                    <li class="mui-table-view-cell">
                        <a class="mui-navigate-right" href="./page/job/website.html">
                            <span class="mui-icon mui-icon-paperclip web" style="font-size: 12px;"></span>
                            <span class="num">网站</span>
                        </a>
                    </li>
                    <li class="mui-table-view-cell">
                        <a class="mui-navigate-right" href="./page/job/application.html">
                            <span class="mui-icon mui-icon-eye" style="font-size: 12px;"></span>
                            <span class="num">应用</span>
                        </a>
                    </li>
                    <li class="mui-table-view-cell">
                        <a class="mui-navigate-right" href="./page/job/book.html">
                            <span class="mui-icon mui-icon-star book" style="font-size: 12px;"></span>
                            <span class="num">书架</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div id="tabbar-with-map" class="mui-control-content" v-show="tabId == 4">
                <header class="mui-bar mui-bar-nav">
                    <h1 class="mui-title">
                        我
                    </h1>
                </header>
                <div class="title">
                    <img src="images/tx.jpeg" alt="">
                    <div class="right">
                        <span v-html="userName"></span>

                    </div>
                </div>
                <ul class="mui-table-view">
                    <li class="mui-table-view-cell" style="padding: 0 15px;">
                        <a class="mui-navigate-right" href="./page/my/information.html" style="margin: 0;padding: 0;line-height: 40px;">
                            <span class="mui-icon mui-icon-contact mes"></span>
                            <span class="me">个人信息</span>
                        </a>
                    </li>
                    <li class="mui-table-view-cell" style="padding: 0 15px;" v-show="!isCard">
                        <a class="mui-navigate-right" href="./page/user/card.html" style="margin: 0;padding: 0;line-height: 40px;">
                            <span class="mui-icon mui-icon-chatboxes card"></span>
                            <span class="me">绑定卡号</span>
                        </a>
                    </li>
                    <li class="mui-table-view-cell" style="padding: 0 15px;">
                        <a class="mui-navigate-right" href="./page/user/modify.html" style="margin: 0;padding: 0;line-height: 40px;">
                            <span class="mui-icon mui-icon-compose pass"></span>
                            <span class="me">修改密码</span>
                        </a>
                    </li>
                    <li class="mui-table-view-cell" style="padding: 0 15px;">
                        <a class="mui-navigate-right" href="./page/job/locationType.html" style="margin: 0;padding: 0;line-height: 40px;">
                            <span class="mui-icon mui-icon-navigate pass"></span>
                            <span class="me">定位模式</span>
                        </a>
                    </li>
                    <li class="mui-table-view-cell" style="padding: 0 15px;">
                        <a class="mui-navigate-right" href="./page/my/suggestion.html" style="margin: 0;padding: 0;line-height: 40px;">
                            <span class="mui-icon mui-icon-email pass"></span>
                            <span class="me">意见反馈</span>
                        </a>
                    </li>
                </ul>
                <ul class="mui-table-view outbox" style="margin-top: 15px;">
                    <li class="mui-table-view-cell" style="padding: 0 15px;">
                        <a class="mui-navigate-right" style="margin: 0;padding: 0;line-height: 40px;">
                            <span class="mui-icon mui-icon-eye"></span>
                            <span class="me">护眼模式
                            </span>
                        </a>
                        <div class="mui-switch mui-switch-mini" :class="{'mui-active' : isActive}" style="width: 38px; height: 19px;" @click="toggleEye">
                            <div class="mui-switch-handle" style="width: 20px; height: 20px; top: -3px;"></div>
                        </div>
                    </li>
                </ul>
                <button type="button" class="mui-btn mui-btn-block mui-btn-primary" style="font-size: 12px;" @click="getexit">退出登录</button>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="plugin/js/mui.min.js"></script>
<script src="plugin/js/vue.js"></script>
<script type="text/javascript" src="plugin/js/axios.js"></script>
<script src="plugin/js/mui.indexedlist.js"></script>
<script src="common.js"></script>
<script type="text/javascript" charset="utf-8">
    var vm = new Vue({
        el: '#app',
        data: {
            showtri: false,
            showbox: false,
            tabId: 1,
            userName: '',
            mailList: [],
            isActive: false,
            searchMail: '',
            isSearch: false,
            mailListA: [],
            mailListB: [],
            mailListC: [],
            mailListD: [],
            mailListE: [],
            mailListF: [],
            mailListG: [],
            mailListH: [],
            mailListI: [],
            mailListJ: [],
            mailListK: [],
            mailListL: [],
            mailListM: [],
            mailListN: [],
            mailListO: [],
            mailListP: [],
            mailListQ: [],
            mailListR: [],
            mailListS: [],
            mailListT: [],
            mailListU: [],
            mailListV: [],
            mailListW: [],
            mailListX: [],
            mailListY: [],
            mailListZ: [],
            mailListUU: [],
            mailListSearch: [],

            isCard: false
        },
        mounted: function () {
            this.isLogin();
            this.init();
            this.timer();
            this.getQueryDeviceInfo();
        },

        watch: {
            searchMail: function () {
                this.isSearch = true;
                this.mailListSearch = [];
                for (var i = 0; i < this.mailList.length; i++) {
                    if (this.mailList[i].pym.indexOf(this.searchMail) > -1 || this.mailList[i].contactName.indexOf(this.searchMail) > -1) {
                        this.mailListSearch.push(this.mailList[i])
                    }
                }
                if (this.searchMail == '') {
                    this.isSearch = false
                }
            }
        },
        methods: {
            init() {
                // 获取最新位置
                var map = new BMap.Map("allmap"); // 创建Map实例
                map.centerAndZoom(new BMap.Point(116.404, 39.915), 11); // 初始化地图,设置中心点坐标和地图级别
                var point = new BMap.Point(sessionStorage.getItem('newlog'), sessionStorage.getItem('newlat'));
                map.centerAndZoom(point, 12);
                var marker = new BMap.Marker(point);  // 创建标注
                map.addOverlay(marker);               // 将标注添加到地图中
                // 获取围栏位置
                axios({
                    method: 'post',
                    url: JTURLAPI + '/app/district/list',
                    params: {
                        deviceId: localStorage.getItem('deviceId')
                        // deviceId: '12345678'
                    },
                    headers: {
                        "Content-Type": "application/json;charset=UTF-8"
                    }

                }).then(function (res) {
                    var info = res.data.data;
                    // console.log(info);
                    var info1 = JSON.parse(info);
                    // console.log(info1);
                    if (info1.status == 0) {
                        var fence = info1.fences[0];
                        var str = JSON.stringify(fence.vertexes);
                        localStorage.setItem('longitude', fence.longitude);
                        localStorage.setItem('latitude', fence.latitude);
                        localStorage.setItem('radius', fence.radius);
                        localStorage.setItem('paths', str);
                        /* console.log(fence.longitude);
                            console.log(fence.latitude);
                            console.log(fence.radius); */
                        // console.log(fence.vertexes[0].longitude);


                        //创建多边形
                        /*  var polygon = new BMap.Polygon([
                             new BMap.Point(fence.vertexes[0].longitude, fence.vertexes[0].latitude),
                             new BMap.Point(fence.vertexes[1].longitude, fence.vertexes[1].latitude),
                             new BMap.Point(fence.vertexes[2].longitude, fence.vertexes[2].latitude),
                             new BMap.Point(fence.vertexes[3].longitude, fence.vertexes[3].latitude),
                         ], {
                                 strokeColor: "red",
                                 fillColor: "red",
                                 fillOpacity: 0.6,
                                 strokeWeight: 2,
                                 strokeOpacity: 0.5
                             });
                         map.addOverlay(polygon);  */

                    }

                });
                // 百度地图API功能
                var map = new BMap.Map("allmap"); // 创建Map实例
                map.centerAndZoom(new BMap.Point(116.404, 39.915), 11); // 初始化地图,设置中心点坐标和地图级别
                var point = new BMap.Point(sessionStorage.getItem('newlog'), sessionStorage.getItem('newlat'));
                map.centerAndZoom(point, 12);
                var marker = new BMap.Marker(point);  // 创建标注
                map.addOverlay(marker);               // 将标注添加到地图中

                // 逆地址转化
                var geoc = new BMap.Geocoder();
                geoc.getLocation(point, function (rs) {
                    var addComp = rs.addressComponents;
                    var region = addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber;
                    sessionStorage.setItem('reg', region);
                });

                //    定位信息框
                var opts = {
                    width: 107,     // 信息窗口宽度
                    height: 150,     // 信息窗口高度
                    title: "定位信息", // 信息窗口标题
                    enableMessage: true,//设置允许信息窗发送短息
                }
                var infoWindow = new BMap.InfoWindow(
                    "设备号：" + localStorage.getItem('deviceId') + "</br>" +
                    "经度：" + sessionStorage.getItem('newlog') + "</br>" +
                    "纬度：" + sessionStorage.getItem('newlat') + "</br>" +
                    "时间：" + sessionStorage.getItem('localtime') + "</br>"
                    + "所在区域：" + sessionStorage.getItem('reg'),
                    opts);  // 创建信息窗口对象
                marker.addEventListener("click", function () {
                    map.openInfoWindow(infoWindow, point); //开启信息窗口
                });

                /*var geolocation = new BMap.Geolocation();
                 geolocation.getCurrentPosition(function (r) {
                     if (this.getStatus() == BMAP_STATUS_SUCCESS) {
                         var mk = new BMap.Marker(r.point);
                         map.addOverlay(mk);
                         map.panTo(r.point);
                     } else {
                         alert('failed' + this.getStatus());
                     }
                 }); */
                var circle = new BMap.Circle(point, localStorage.getItem('radius'), {
                    strokeColor: "red",
                    fillColor: "red",
                    fillOpacity: 0.6,
                    strokeWeight: 2,
                    strokeOpacity: 0.5
                });

                map.addOverlay(circle);  //创建圆形
                //添加地图类型控件
                map.addControl(new BMap.MapTypeControl({
                    mapTypes: [
                        BMAP_NORMAL_MAP,
                        BMAP_HYBRID_MAP
                    ]
                }));
                map.setCurrentCity("北京"); // 设置地图显示的城市 此项是必须设置的
                // map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
                map.enablePinchToZoom(); //开启双指操作缩放
                setInterval(() => {
                    this.timer();
                }, 60000)
            },
            timer: function () {
                axios({
                    method: 'post',
                    url: JTURLAPI + '/app/gps/lastPoint',
                    params: {
                        // entity_name: 1533981932
                        entity_name: localStorage.getItem('deviceId')
                    }

                }).then(function (res) {
                    var info = res.data.data;
                    var info1 = JSON.parse(info);
                    // console.log(info1);
                    function timestampToTime(timestamp) {
                        var date = new Date(timestamp * 1000);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
                        Y = date.getFullYear() + '-';
                        M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
                        D = date.getDate() + ' ';
                        h = date.getHours() + ':';
                        m = date.getMinutes() + ':';
                        s = date.getSeconds();
                        return Y + M + D + h + m + s;
                    }
                    var time = timestampToTime(info1.latest_point.loc_time);
                    /*  var unixTimestamp = new Date(info1.latest_point.loc_time * 1000);
                         commonTime = unixTimestamp.toLocaleString(); */
                    sessionStorage.setItem('newlog', info1.latest_point.longitude);
                    sessionStorage.setItem('newlat', info1.latest_point.latitude);
                    sessionStorage.setItem('localtime', time)
                });

            },
            delfence: function () {
                if (localStorage.getItem('deviceId')) {
                    var btnArray = ['否', '是'];
                    mui.confirm('确认删除地图上的围栏吗？', '亲', btnArray, function (e) {
                        if (e.index == 1) {
                            axios({
                                method: 'post',
                                url: JTURLAPI + '/app/district/delete',
                                params: {
                                    deviceId: localStorage.getItem('deviceId')
                                },
                                headers: {
                                    "Content-Type": "application/json;charset=UTF-8"
                                }
                            }).then((res) => {
                                var info = res.data.data;
                                var info1 = JSON.parse(info);
                                if (info1.status == 0) {
                                    localStorage.removeItem('longitude');
                                    localStorage.removeItem('latitude');
                                    localStorage.removeItem('radius');
                                    window.parent.location.reload();

                                }
                            })
                        } else {
                        }
                    })
                } else {
                    var btnArray = ['否', '是'];
                    mui.confirm('您还没有绑定卡号，无法删除围栏', btnArray, function (e) {
                        if (e.index == 1) {
                            window.location.href = './page/user/card.html';
                        } else {
                        }
                    })
                }

            },
            addall: function () {
                if (localStorage.getItem('deviceId')) {
                    location.href = "page/location/all.html";
                } else {
                    var btnArray = ['否', '是'];
                    mui.confirm('您还没有绑定卡号，确认绑定', btnArray, function (e) {
                        if (e.index == 1) {
                            window.location.href = './page/user/card.html';
                        } else { }
                    })
                }
                window.location.href = "page/location/all.html";
            },
            isLogin: function () {
                if (window.localStorage.getItem('token')) {
                    this.getTabId()
                    axios({
                        method: 'post',
                        url: JTURLAPI + '/app/user/autoLogin',
                        params: {
                            token: window.localStorage.getItem("token"),
                            userId: window.localStorage.getItem("userId"),
                        },
                    }).then((res) => {
                        if (res.data.code == 0) {
                            console.log(res.data.msg);
                            this.userName = window.localStorage.getItem('userName')
                            this.getForcedClosure()
                        } else {
                            mui.alert('登录凭证已失效,请重新登录', function () {
                                window.location.href = './page/user/login.html'
                            });
                        }
                    }).catch(err => {
                        mui.toast('请检查网络是否打开', {
                            duration: 'long',
                            type: 'div'
                        })
                    })
                } else {
                    window.location.href = 'page/user/login.html'
                }
            },
            getexit: function () {
                var btnArray = ['否', '是'];
                mui.confirm('确认退出吗？', '亲', btnArray, function (e) {
                    if (e.index == 1) {
                        location.href = 'page/user/login.html';
                        window.localStorage.removeItem('userId')
                        window.localStorage.removeItem('token')
                        window.localStorage.removeItem('tabId')
                    } else {
                    }
                })
            },
            toggleEye: function () {
                var statu = hasClass(document.getElementsByClassName('mui-switch')[0], 'mui-active')
                if (statu) {
                    var data = JSON.stringify({
                        "userId": window.localStorage.getItem("userId"),
                        "token": window.localStorage.getItem("token"),
                        "forcedClosure": 0
                    });
                    axios({
                        method: 'post',
                        url: JTURLAPI + '/app/user/changeUserMsg',
                        data: data,
                        headers: {
                            "Content-Type": "application/json;charset=UTF-8"
                        }
                    }).then((res) => {
                        if (res.data.code == 0) {
                            mui.toast('您已开启学生亮屏90分钟强制关屏', {
                                duration: 'long',
                                type: 'div'
                            })
                        } else {
                            mui.toast('res.data.msg', {
                                duration: 'long',
                                type: 'div'
                            })
                        }
                    })
                } else {
                    var data = JSON.stringify({
                        "userId": window.localStorage.getItem("userId"),
                        "token": window.localStorage.getItem("token"),
                        "forcedClosure": 1
                    });
                    axios({
                        method: 'post',
                        url: JTURLAPI + '/app/user/changeUserMsg',
                        data: data,
                        headers: {
                            "Content-Type": "application/json;charset=UTF-8"
                        }
                    }).then((res) => {
                        if (res.data.code == 0) {
                            mui.toast('您已关闭学生亮屏90分钟强制关屏', {
                                duration: 'long',
                                type: 'div'
                            })
                        } else {
                            mui.toast('res.data.msg', {
                                duration: 'long',
                                type: 'div'
                            })
                        }
                    })
                }
            },
            setTabId: function (i) {
                if (i == 1) {
                    this.tabId = 1
                } else if (i == 2) {
                    this.tabId = 2
                } else if (i == 3) {
                    this.tabId = 3
                } else if (i == 4) {
                    this.tabId = 4
                }
                window.localStorage.setItem('tabId', i);
            },
            getTabId: function () {
                var x = window.localStorage.getItem('tabId')
                if (x == undefined) {
                    this.tabId = 1
                } else if (x == 1) {
                    this.tabId = 1
                } else if (x == 2) {
                    this.tabId = 2
                } else if (x == 3) {
                    this.tabId = 3
                } else if (x == 4) {
                    this.tabId = 4
                }
                this.getMailList();
            },
            getMailList: function () {
                axios({
                    method: 'post',
                    url: JTURLAPI + '/app/contact/contactList',
                    params: {
                        token: window.localStorage.getItem("token"),
                        userId: window.localStorage.getItem("userId"),
                        pageSize: 10000
                    },
                }).then((res) => {
                    if (res.data.code == 0) {
                        this.mailList = res.data.page.list
                        for (var i = 0; i < this.mailList.length; i++) {
                            var tt = this.mailList[i].pym.substring(0, 1);
                            switch (tt) {
                                case tt = 'a':
                                    this.mailListA.push(this.mailList[i])
                                    break;
                                case tt = 'b':
                                    this.mailListB.push(this.mailList[i])
                                    break;
                                case tt = 'c':
                                    this.mailListC.push(this.mailList[i])
                                    break;
                                case tt = 'd':
                                    this.mailListD.push(this.mailList[i])
                                    break;
                                case tt = 'e':
                                    this.mailListE.push(this.mailList[i])
                                    break;
                                case tt = 'f':
                                    this.mailListF.push(this.mailList[i])
                                    break;
                                case tt = 'g':
                                    this.mailListG.push(this.mailList[i])
                                    break;
                                case tt = 'h':
                                    this.mailListH.push(this.mailList[i])
                                    break;
                                case tt = 'i':
                                    this.mailListI.push(this.mailList[i])
                                    break;
                                case tt = 'j':
                                    this.mailListJ.push(this.mailList[i])
                                    break;
                                case tt = 'k':
                                    this.mailListK.push(this.mailList[i])
                                    break;
                                case tt = 'l':
                                    this.mailListL.push(this.mailList[i])
                                    break;
                                case tt = 'm':
                                    this.mailListM.push(this.mailList[i])
                                    break;
                                case tt = 'n':
                                    this.mailListN.push(this.mailList[i])
                                    break;
                                case tt = 'o':
                                    this.mailListO.push(this.mailList[i])
                                    break;
                                case tt = 'p':
                                    this.mailListP.push(this.mailList[i])
                                    break;
                                case tt = 'q':
                                    this.mailListQ.push(this.mailList[i])
                                    break;
                                case tt = 'r':
                                    this.mailListR.push(this.mailList[i])
                                    break;
                                case tt = 's':
                                    this.mailListS.push(this.mailList[i])
                                    break;
                                case tt = 't':
                                    this.mailListT.push(this.mailList[i])
                                    break;
                                case tt = 'u':
                                    this.mailListU.push(this.mailList[i])
                                    break;
                                case tt = 'v':
                                    this.mailListV.push(this.mailList[i])
                                    break;
                                case tt = 'w':
                                    this.mailListW.push(this.mailList[i])
                                    break;
                                case tt = 'x':
                                    this.mailListX.push(this.mailList[i])
                                    break;
                                case tt = 'y':
                                    this.mailListY.push(this.mailList[i])
                                    break;
                                case tt = 'z':
                                    this.mailListZ.push(this.mailList[i])
                                    break;
                                default:
                                    this.mailListUU.push(this.mailList[i])
                                    break;
                            }

                        }
                    } else {
                        mui.toast(res.data.msg, {
                            duration: 'long',
                            type: 'div'
                        })
                    }
                }).catch(err => {
                    mui.toast('请检查网络是否连接', {
                        duration: 'long',
                        type: 'div'
                    })
                })
            },
            gotoListMsg: function (it) {
                window.location.href = "./page/mailList/myself.html" + '?' + it.id;
            },
            getForcedClosure: function () {
                axios({
                    method: 'post',
                    url: JTURLAPI + '/app/user/userInformation',
                    data: {
                        token: window.localStorage.getItem("token"),
                        userId: window.localStorage.getItem("userId")
                    },
                    transformRequest: [function (data) {
                        let ret = ''
                        for (let it in data) {
                            ret += encodeURIComponent(it) + '=' + encodeURIComponent(data[it]) + '&'
                        }
                        return ret
                    }],
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then((res) => {
                    console.log(res.data.userInformation.forcedClosure);
                    if (res.data.userInformation.forcedClosure == 0) {
                        //打开
                        this.isActive = true
                    } else {
                        this.isActive = false
                    }

                    window.localStorage.setItem("courseStatus", res.data.userInformation.courseStatus);
                    window.localStorage.setItem("deviceId", res.data.userInformation.deviceSerial);
                })
            },
            changeCount: function () {
                // this.isSearch = false
                // this.searchMail = ''
            },
            getQueryDeviceInfo: function () {
                axios({
                    method: 'post',
                    url: JTURLAPI + '/app/device/queryDeviceInfo',
                    params: {
                        userId: localStorage.getItem('userId'),
                        token: localStorage.getItem('token')
                    }
                }).then((res) => {
                    if (res.data.code == 0) {
                        localStorage.setItem('locationType', res.data.locateFrequebce);
                        this.isCard = true;
                    } else if (res.data.code = 203) {
                        mui.toast(res.data.msg, {
                            duration: 'long',
                            type: 'div'
                        });
                        this.isCard = false;
                    }
                });
            }
        },
    })
</script>

</html>